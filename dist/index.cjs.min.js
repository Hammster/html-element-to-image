"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const prefix="___",captureShowClass="___capture-show",captureHideClass="___capture-hide",forceOverflowClass="___force-overflow",defaultOptions={customStyle:"",excludedNodes:[],returnType:"dataUrl",targetNode:document.body};let config=defaultOptions;function addClasses(e){e.classList.add(captureShowClass);let t=e.parentElement;for(const e of config.excludedNodes)e.classList.add(captureHideClass);for(;t;)t.classList.add(forceOverflowClass),t=t.parentElement}function removeClasses(e){e.classList.remove(captureShowClass);let t=e.parentElement;for(const e of config.excludedNodes)e.classList.remove(captureHideClass);for(;t;)t.classList.remove(forceOverflowClass),t=t.parentElement}function serializeHead(e){const t=document.head.cloneNode(!0),o=document.createElement("style");for(const e of Array.from(t.childNodes))e instanceof HTMLStyleElement||e.remove();o.innerText+="foreignObject>div {",o.innerText+="position: fixed;",o.innerText+=`top: ${window.outerHeight}px;`,o.innerText+="overflow: visible;",o.innerText+="}",o.innerText+=`.${captureShowClass} {`,o.innerText+="position: fixed;",o.innerText+="left: 0;",o.innerText+="top: 0;",o.innerText+=`width: ${e.width}px;`,o.innerText+=`height: ${e.height}px;`,o.innerText+="}",o.innerText+=`.${captureHideClass} {display: none !important;}`,o.innerText+=`.${forceOverflowClass} {overflow: visible !important;}`,o.innerText+=config.customStyle,t.appendChild(o);let n="";for(const e of Array.from(t.querySelectorAll("style")))n+=e.outerHTML;return n}function serializeBody(){return document.body.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/g,"")}function combineToSvg(e,t){addClasses(e);const o=serializeHead(t),n=serializeBody(),r=(t.left,t.top,document.createElementNS("http://www.w3.org/2000/svg","svg"));r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("height",t.height.toString()),r.setAttribute("width",t.width.toString());const i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");i.removeAttribute("xmlns"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("height",window.outerHeight.toString()),i.setAttribute("width",window.outerWidth.toString());const s=document.createElement("div");return s.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),s.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),s.setAttribute("class",document.body.className),s.innerHTML=n,i.appendChild(s),r.insertAdjacentHTML("afterbegin",o),r.appendChild(i),removeClasses(e),(new XMLSerializer).serializeToString(r)}function NodeToDataURL(e){const t=(config=Object.assign(Object.assign({},defaultOptions),e)).targetNode,o=t.getBoundingClientRect(),n=combineToSvg(t,o),r=`data:image/svg+xml;base64,${btoa(n)}`,i=document.createElement("canvas");return new Promise((e,t)=>{if(!i)return void t();const n=document.createElement("img");n.addEventListener("error",()=>{i.remove(),t()}),n.addEventListener("load",()=>{i.width=o.width,i.height=o.height,i.getContext("2d").drawImage(n,0,0),e(i.toDataURL()),i.remove()}),n.src=r})}exports.NodeToDataURL=NodeToDataURL;