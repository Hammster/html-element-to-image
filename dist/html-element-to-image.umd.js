(function(s,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(s=typeof globalThis<"u"?globalThis:s||self,s.nodeToDataURL=d())})(this,function(){"use strict";const s="___",d=`${s}capture-show`,u=`${s}capture-hide`,m=`${s}force-overflow`,f={customStyle:"",excludedNodes:[],returnType:"dataUrl",targetNode:document.body};let a=f;function g(n){n.classList.add(d);let t=n.parentElement;for(const e of a.excludedNodes)e.classList.add(u);for(;t;)t.classList.add(m),t=t.parentElement}function w(n){n.classList.remove(d);let t=n.parentElement;for(const e of a.excludedNodes)e.classList.remove(u);for(;t;)t.classList.remove(m),t=t.parentElement}function x(n){const t=document.head.cloneNode(!0),e=document.createElement("style");for(const r of Array.from(t.childNodes))r instanceof HTMLStyleElement||r.remove();e.innerText+="foreignObject>div {",e.innerText+="position: fixed;",e.innerText+=`top: ${window.outerHeight}px;`,e.innerText+="overflow: visible;",e.innerText+="}",e.innerText+=`.${d} {`,e.innerText+="position: fixed;",e.innerText+="left: 0;",e.innerText+="top: 0;",e.innerText+=`width: ${n.width}px;`,e.innerText+=`height: ${n.height}px;`,e.innerText+="}",e.innerText+=`.${u} {display: none !important;}`,e.innerText+=`.${m} {overflow: visible !important;}`,e.innerText+=a.customStyle,t.appendChild(e);let c="";for(const r of Array.from(t.querySelectorAll("style")))c+=r.outerHTML;return c}function v(){return document.body.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/g,"")}function T(n,t){g(n);const e=x(t),c=v();-t.left,-t.top;const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("height",t.height.toString()),r.setAttribute("width",t.width.toString());const i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");i.removeAttribute("xmlns"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("height",window.outerHeight.toString()),i.setAttribute("width",window.outerWidth.toString());const o=document.createElement("div");return o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),o.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),o.setAttribute("class",document.body.className),o.innerHTML=c,i.appendChild(o),r.insertAdjacentHTML("afterbegin",e),r.appendChild(i),w(n),new XMLSerializer().serializeToString(r)}function b(n){a={...f,...n};const t=a.targetNode,e=t.getBoundingClientRect(),c=T(t,e),i=`data:image/svg+xml,${encodeURIComponent(c)}`,o=document.createElement("canvas");return new Promise((h,p)=>{if(!o){p();return}const l=document.createElement("img");l.addEventListener("error",()=>{o.remove(),p()}),l.addEventListener("load",()=>{o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(l,0,0),h(o.toDataURL()),o.remove()}),l.src=i})}return b});
